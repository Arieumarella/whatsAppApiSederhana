version: "3.8"

services:
  whatsapp-api:
    build:
      context: .
    container_name: whatsapp-api
    ports:
      - "5000:5000"
    volumes:
      # 1. Map source code from host to container for easy updates (bind mount)
      - ./:/app

      # 2. Prevent host node_modules from overriding the container-installed modules
      - /app/node_modules

      # 3. Persist session/token data (kept for compatibility with session-based flows)
      - whatsapp_sessions:/app/tokens

    # Use the env file for runtime configuration
    env_file:
      - ./.env

    # Provide extra capabilities similar to your venom compose
    cap_add:
      - SYS_ADMIN
    restart: unless-stopped
    # Use production start by default. For development you can override with `command: npm run dev`
    command: node server.js

volumes:
  whatsapp_sessions:
